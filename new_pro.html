<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bubble Pop Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#a2d4f2">
  <link rel="icon" href="data:,">
  <link rel="manifest" href="data:application/manifest+json,{%22name%22%3A%22Bubble%20Pop%22%2C%22short_name%22%3A%22BubblePop%22%2C%22start_url%22%3A%22.%2Findex.html%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23a2d4f2%22%2C%22theme_color%22%3A%22%23a2d4f2%22}">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #a2d4f2, #ffffff);
    }
    #scoreBoard {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(8px);
      padding: 15px 25px;
      border-radius: 15px;
      font-size: 22px;
      font-weight: bold;
      color: #007acc;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }
    #gameOver {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      font-weight: bold;
      color: #ffffff;
      text-shadow: 2px 2px 8px #000;
      display: none;
      z-index: 2000;
    }
    select {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 16px;
      padding: 5px;
      z-index: 1000;
    }
    .bubble {
      position: absolute;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #ffffff88, #00bfff);
      border: 2px solid #a8e8ff;
      border-radius: 50%;
      box-shadow: inset -2px -2px 5px #ffffff55, 0 5px 10px #00bfff55;
      animation: floatUp linear;
      cursor: pointer;
      transition: transform 0.1s ease;
    }
    .bubble:active {
      transform: scale(0.9);
    }
    @keyframes floatUp {
      from {
        transform: translateY(100vh);
        opacity: 1;
      }
      to {
        transform: translateY(-100px);
        opacity: 0.2;
      }
    }
  </style>
</head>
<body>

<audio id="popSound" src="https://www.soundjay.com/button/sounds/button-16.mp3" preload="auto"></audio>

<div id="scoreBoard">Score: 0</div>
<select id="difficulty">
  <option value="easy">Easy</option>
  <option value="medium" selected>Medium</option>
  <option value="hard">Hard</option>
</select>
<div id="gameOver">⏱️ Time's up!<br>Your Score: <span id="finalScore">0</span></div>

<script>
  // Service worker for PWA (inline)
  if ('serviceWorker' in navigator) {
    const swCode = `
      const CACHE_NAME = 'bubble-pop-cache-v1';
      const urlsToCache = ['.'];
      self.addEventListener('install', event => {
        event.waitUntil(
          caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
        );
      });
      self.addEventListener('fetch', event => {
        event.respondWith(
          caches.match(event.request).then(response => response || fetch(event.request))
        );
      });
    `;
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swURL = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swURL);
  }

  let score = 0;
  let timeLeft = 30;
  const scoreBoard = document.getElementById('scoreBoard');
  const gameOverDisplay = document.getElementById('gameOver');
  const finalScore = document.getElementById('finalScore');
  const popSound = document.getElementById('popSound');

  function getDifficultySettings() {
    const level = document.getElementById('difficulty').value;
    if (level === 'easy') return { interval: 800, min: 4, max: 6 };
    if (level === 'hard') return { interval: 300, min: 2, max: 3.5 };
    return { interval: 500, min: 3, max: 5 };
  }

  const { interval, min, max } = getDifficultySettings();

  function createBubble() {
    const bubble = document.createElement('div');
    bubble.className = 'bubble';

    const size = 40 + Math.random() * 40;
    bubble.style.width = size + 'px';
    bubble.style.height = size + 'px';

    const duration = min + Math.random() * (max - min);
    bubble.style.animationDuration = duration + 's';

    bubble.style.left = Math.random() * (window.innerWidth - size) + 'px';

    function pop() {
      score++;
      scoreBoard.textContent = 'Score: ' + score;
      popSound.currentTime = 0;
      popSound.play();
      bubble.remove();
    }

    bubble.onclick = pop;
    bubble.addEventListener('touchstart', pop);
    bubble.addEventListener('animationend', () => bubble.remove());

    document.body.appendChild(bubble);
  }

  const bubbleInterval = setInterval(() => {
    if (timeLeft > 0) createBubble();
  }, interval);

  const timer = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timer);
      clearInterval(bubbleInterval);
      document.querySelectorAll('.bubble').forEach(b => b.remove());
      finalScore.textContent = score;
      gameOverDisplay.style.display = 'block';
    }
  }, 1000);
</script>

</body>
</html>
